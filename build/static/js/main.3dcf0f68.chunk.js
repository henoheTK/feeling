(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{29:function(e,t,n){},44:function(e,t,n){},56:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},85:function(e,t,n){},89:function(e,t,n){},90:function(e,t,n){},91:function(e,t,n){},92:function(e,t,n){"use strict";n.r(t);var o=n(2),c=n(3),s=n(31),i=n.n(s),a=n(19),r=n(6),l=n.n(r),d=n(13),u=n(9),m=n(11),j=n(26);j.a.initializeApp({apiKey:"AIzaSyBKyumc6NOpVRBhKbXxz06lN0HP5xztT8Y",authDomain:"emoichat-300700.firebaseapp.com",projectId:"emoichat-300700",storageBucket:"emoichat-300700.appspot.com",messagingSenderId:"349007819425",appId:"1:349007819425:web:3b35c57290d3aac32d36e0",measurementId:"G-8HGXFZXEQT"}),j.a.analytics();var f=j.a,p=j.a.firestore(),h={happy:["leftEye","rightEye","mouth"],angry:["leftEye","rightEye","mouth"]},b=function(e){var t=function(t){var n,c,s=t.info;return e.emotion&&-1!==h[e.emotion].indexOf(s[0])?(n="../images/icon/"+e.emotion+"_"+s[0]+".png",c=0):(n="../images/icon/"+s[1].kind+"_"+s[0]+".png",c=parseInt(s[1].rot)),Object(o.jsx)("img",{className:e.where+"-iconparts "+s[0],src:n,style:{height:s[1].sizeY/300*e.iconSize+"px",width:s[1].sizeX/300*e.iconSize+"px",top:s[1].posY/300*e.iconSize+"px",left:s[1].posX/300*e.iconSize+"px",position:"absolute",transform:"rotate("+c+"deg)"}},s[0])};return Object(o.jsxs)("div",{className:e.where+"-icon",style:{position:"relative",height:e.iconSize+"px",width:e.iconSize+"px"},children:[console.log(e.iconInfo),Object.entries(e.iconInfo).map((function(e){return Object(o.jsx)(t,{info:e},e[0])}))]})};n(56);var x=function(){var e=Object(c.useContext)(ce),t=e.isOnline,n=e.userId,s=e.userInfo,i=Object(c.useState)(null),a=Object(u.a)(i,2),r=a[0],l=a[1],d=Object(c.useState)(null),m=Object(u.a)(d,2),j=m[0],h=m[1];return Object(c.useEffect)((function(){s&&(s.room&&p.collection("rooms").doc(s.room).get().then((function(e){e.exists?h([e.id,e.data().roomName]):p.collection("users").doc(n).update({room:null})})),0!==s.rooms.length?p.collection("rooms").where(f.firestore.FieldPath.documentId(),"in",s.rooms).get().then((function(e){var t={},o=[];console.log(e),e.empty?(l(!1),p.collection("users").doc(n).update({rooms:[]})):(e.docs.forEach((function(e){e.exists&&(t[e.id]=e.data().roomName,console.log(e,e.id,e.data().roomName,e.data()),o.push(e.id))})),l(t),o.length!==s.rooms.length&&p.collection("users").doc(n).update({rooms:o}),console.log(t))})).catch((function(e){console.log("Error:"+e)})):l(!1))}),[s]),Object(o.jsx)("nav",{className:"navbar navbar-default",children:Object(o.jsxs)("div",{className:"container-fluid",children:[Object(o.jsxs)("div",{className:"navbar-header",children:[Object(o.jsxs)("button",{type:"button",className:"navbar-toggle collapsed","data-toggle":"collapse","data-target":"#bs-example-navbar-collapse-1",children:[Object(o.jsx)("span",{className:"sr-only",children:"Toggle navigation"}),Object(o.jsx)("span",{className:"icon-bar"}),Object(o.jsx)("span",{className:"icon-bar"}),Object(o.jsx)("span",{className:"icon-bar"})]}),Object(o.jsx)("a",{className:"navbar-brand",href:"/",children:"\u30a8\u30e2\u3044\u30c1\u30e3\u30c3\u30c8\u3002"})]}),Object(o.jsxs)("div",{className:"collapse navbar-collapse",id:"bs-example-navbar-collapse-1",children:[Object(o.jsxs)("ul",{className:"nav navbar-nav",children:[Object(o.jsx)("li",{className:"",children:Object(o.jsxs)("a",{href:"/",children:["\u30db\u30fc\u30e0",Object(o.jsx)("span",{className:"sr-only",children:"(current)"})]})}),null!==j&&Object(o.jsx)("li",{className:"active",children:Object(o.jsxs)("a",{href:"/room/"+j[0],children:[j[1],Object(o.jsx)("span",{className:"sr-only",children:"(current)"})]})}),Object(o.jsxs)("li",{className:"dropdown",children:[Object(o.jsxs)("a",{className:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-expanded":"false",children:["\u30eb\u30fc\u30e0s ",Object(o.jsx)("span",{className:"caret"})]}),Object(o.jsxs)("ul",{className:"dropdown-menu",role:"menu",children:[!1===r&&Object(o.jsx)("li",{children:Object(o.jsx)("p",{children:"\u307e\u3060\u5165\u5ba4\u3057\u3066\u3044\u308b\u30eb\u30fc\u30e0\u304c\u3042\u308a\u307e\u305b\u3093"})}),null!==r&&!1!==r&&Object.entries(r).map((function(e){return Object(o.jsx)("li",{children:Object(o.jsx)("a",{href:"/room/"+e[0],children:e[1]})},e[0])}))]})]})]}),!0===t&&Object(o.jsx)("ul",{className:"nav navbar-nav navbar-right",children:Object(o.jsxs)("li",{id:"userInfo-li",href:"/userSetting",children:[Object(o.jsx)("a",{id:"infoLink-icon",href:"/userSetting"}),Object(o.jsxs)("div",{href:"/userSetting",className:"iconMask barMask",children:[null!==s&&Object(o.jsx)(b,{iconInfo:s.iconinfo,where:"header",iconSize:"50"}),Object(o.jsx)("h6",{id:"icon-loading-text",children:"loading icon..."})]})]})})]})]})})},O=(n(24),n(74),n(75),n(29),function(e){var t=Object(c.useContext)(S).reActions;return Object(o.jsxs)("div",{id:"reActions",className:"icon-acce",children:[console.log(e.renderId,t),t[e.renderId].map((function(e){return Object(o.jsx)("div",{children:Object(o.jsx)("h1",{children:e.name})},e.id)}))]})}),g=function(e){var t=Object(c.useContext)(S).newComment;return Object(o.jsx)("div",{className:"balloon1 icon-acce top",children:Object(o.jsx)("div",{className:"balloon1-text",children:Object(o.jsx)("p",{children:t[e.renderId]})})},e.renderId)},v=function(e){var t=Object(c.useContext)(X).room,n=Object(c.useContext)(ce).userId,s=function(e){var o=e.target.dataset.name,c=e.target.dataset.user;console.log(o,c),p.collection("rooms").doc(t.id).collection("reActions").add({name:o,from:n,to:c,timeStamp:f.firestore.FieldValue.serverTimestamp()}).then((function(e){setTimeout((function(){p.collection("rooms").doc(t.id).collection("reActions").doc(e.id).delete()}),3e3)})).catch((function(e){console.log(e)}))};return Object(o.jsxs)("div",{className:"icon-acce reActionbuttons",children:[Object(o.jsx)("button",{className:"reActionButton",onClick:s,"data-name":"good","data-user":e.renderId,children:"good"}),Object(o.jsx)("button",{className:"reActionButton",onClick:s,"data-name":"nazo","data-user":e.renderId,children:"\u8b0e"})]})},y=function(e){var t=Object(c.useContext)(ce).userId,n=Object(c.useContext)(S),s=n.emotions,i=n.reActions,a=n.newComment;return Object(o.jsxs)("div",{className:"stageIcon",children:[console.log(e.renderInfo),e.renderInfo[0]!==t&&Object(o.jsx)("h3",{className:"stageIcon-displayName icon-acce",children:e.renderInfo[1].displayName}),e.renderInfo[0]===t&&Object(o.jsx)("h3",{className:"self-mark stageIcon-displayName icon-acce",children:e.renderInfo[1].displayName}),null===a&&Object(o.jsx)("p",{className:"icon-acce",children:"Loading NewComment..."}),null!==a&&a[e.renderInfo[0]]&&Object(o.jsx)(g,{renderId:e.renderInfo[0]}),Object(o.jsx)(b,{iconInfo:e.renderInfo[1].iconInfo,iconSize:200,emotion:s[e.renderInfo[0]],where:"stage"}),e.renderInfo[0]!==t&&Object(o.jsx)(v,{renderId:e.renderInfo[0]}),null===i&&Object(o.jsx)("p",{className:"icon-acce",children:"Loading Actions..."}),null!==i&&i[e.renderInfo[0]]&&Object(o.jsx)(O,{renderId:e.renderInfo[0]})]})};var I=function(e){var t=Object(c.useContext)(X),n=t.members,s=t.room;return Object(o.jsx)("div",{id:"nomal",children:Object.keys(n).map((function(e,t){return Object(o.jsx)("div",{className:"icondiv",children:Object(o.jsx)(y,{renderInfo:[s.members[t],n[s.members[t]]]})},"icondiv"+t)}))})},N=function(){var e=Object(c.useContext)(X).room,t=Object(c.useContext)(S),n=t.emotions,s=t.setEmotions,i=Object(c.useContext)(ce),a=i.userId,r=i.userInfo;function l(){var t=document.getElementById("inputComment").value;if(t.length>0&&t.length<=300){var o,c=e.id;o=n[a]?n[a]:null,p.collection("rooms").doc(c).collection("comments").add({content:t,userId:a,userName:r.displayName,emotion:o,timeStamp:f.firestore.FieldValue.serverTimestamp()}),p.collection("rooms").doc(e.id).collection("newComment").doc(a).set({content:t,timeStamp:f.firestore.FieldValue.serverTimestamp()}).then((function(){document.getElementById("inputComment").value="",setTimeout((function(){p.collection("rooms").doc(e.id).collection("newComment").doc(a).delete()}),6e3)}))}}Object(c.useEffect)((function(){document.body.addEventListener("keydown",(function(e){"Enter"===e.key&&e.ctrlKey&&l()}))}),[]);var d=function(t){var o=t.target.dataset.kind;console.log(o),p.collection("rooms").doc(e.id).collection("emotions").doc(a).set({kind:o,timeStamp:f.firestore.FieldValue.serverTimestamp()});var c=JSON.parse(JSON.stringify(n));c[a]=o,s(c)};return Object(o.jsxs)("div",{id:"commentForm",children:[Object(o.jsxs)("div",{id:"emotions",children:[Object(o.jsx)("button",{className:"emotoButton",onClick:d,"data-kind":"happy",children:"happy"}),Object(o.jsx)("button",{className:"emotoButton",onClick:d,"data-kind":"angry",children:"angry"})]}),Object(o.jsxs)("div",{className:"form",children:[Object(o.jsx)("input",{id:"inputComment"}),Object(o.jsx)("button",{type:"submit",maxLength:"300",onClick:l,children:"\u6295\u7a3f"})]})]})},w=n(23);function E(e){return Math.floor(Math.random()*Math.floor(e))-e/2}var z=function(e,t){return setInterval((function(){!function(e,t,n){var o=window.getComputedStyle(e,null).getPropertyValue("transform").substr(7).split(",").slice(0,4);e.style.transform="matrix("+o[0]+","+o[1]+","+o[2]+","+o[3]+","+E(t)+","+E(n)+")"}(e,5,5)}),t)};var S=Object(c.createContext)([]),k=function(e){Object(c.useContext)(ce).userId;var t=Object(c.useContext)(X),n=(t.icons,t.splitSize),s=t.room,i=Object(c.useState)(null),a=Object(u.a)(i,2),r=a[0],m=a[1],j=Object(c.useState)({}),f=Object(u.a)(j,2),h=f[0],b=f[1],x=Object(c.useState)({}),O=Object(u.a)(x,2),g=O[0],v=O[1],y=s.id;return Object(c.useEffect)((function(){function e(){return(e=Object(d.a)(l.a.mark((function e(){var t,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,n=new Date(t.getTime()-5e3),console.log(n,t),e.next=5,p.collection("/rooms").doc(y).collection("emotions").where("timeStamp",">",n).onSnapshot((function(e){var t=[],n=e.docs.map((function(e){return e.id}));e.forEach((function(e){t.push(e.data())}));for(var o={},c=0;c<n.length;c++)o[n[c]]=t[c].kind;console.log(e,t,o,"\u3093"),b(o)}));case 5:return o=e.sent,e.abrupt("return",(function(){return o()}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t(){return(t=Object(d.a)(l.a.mark((function e(){var t,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,n=new Date(t.getTime()-6e3),e.next=4,p.collection("/rooms").doc(y).collection("newComment").where("timeStamp",">",n).onSnapshot((function(e){var t=[],n=e.docs.map((function(e){return e.id}));e.forEach((function(e){t.push(e.data())}));for(var o={},c=0;c<n.length;c++)o[n[c]]=t[c].content;console.log(e,t,o,"\u3093"),m(o)}));case 4:return o=e.sent,e.abrupt("return",(function(){return o()}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function n(){return(n=Object(d.a)(l.a.mark((function e(){var t,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,n=new Date(t.getTime()-5e3),console.log(n,t),e.next=5,p.collection("/rooms").doc(y).collection("reActions").where("timeStamp",">",n).onSnapshot((function(e){var t=[],n=e.docs.map((function(e){return e.id}));e.forEach((function(e){t.push(e.data())}));for(var o={},c=0;c<n.length;c++)o[t[c].to]||(o[t[c].to]=[]),o[t[c].to].push({id:n[c],name:t[c].name,from:t[c].from,to:t[c].to});console.log(e,t,o,"\u3093"),v(o)}));case 5:return o=e.sent,e.abrupt("return",(function(){return o()}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),function(){t.apply(this,arguments)}(),function(){n.apply(this,arguments)}()}),[]),Object(c.useEffect)((function(){var e=function(){for(var e=[],t=0;t<e.length;t++)clearInterval(e[t]);e=[];for(var n=document.getElementsByClassName("stage-iconparts"),o=0;o<n.length;o++)e.push(z(n[o],1e3));return e}();return function(){e.forEach((function(e){clearInterval(e)}))}})),Object(o.jsx)(S.Provider,{value:{newComment:r,setNewComment:m,emotions:h,setEmotions:b,reActions:g,setActions:v},children:Object(o.jsxs)(w.a,{split:"horizontal",defaultSize:window.innerHeight-171,children:[Object(o.jsxs)("div",{id:"stage",children:[console.log(n),Object(o.jsx)(I,{stageRadius:600})]}),Object(o.jsx)(N,{})]})})},C=(n(79),n(80),n(81),function(){var e=Object(c.useContext)(X).room;return Object(o.jsxs)("header",{id:"room-header",children:[Object(o.jsx)("div",{id:"room-name",children:Object(o.jsx)("strong",{children:e.roomName})}),Object(o.jsxs)("ul",{id:"room-info",children:[Object(o.jsxs)("li",{children:["\u53c2\u52a0\u8005\uff1a",e.members.length]}),Object(o.jsxs)("li",{children:[" \u4f5c\u6210\u8005\uff1a",e.madeUserName]}),Object(o.jsxs)("li",{children:[" \u4f5c\u6210\u65e5\u6642\uff1a",e.madeTime]}),Object(o.jsxs)("li",{children:[" \u30e1\u30f3\u30d0\u30fc\uff1a",e.members.length,"\u4eba"]})]})]})}),B=(n(82),n(45)),X=Object(c.createContext)([]),Y=function(){var e=Object(c.useState)(null),t=Object(u.a)(e,2),n=t[0],s=t[1],i=Object(c.useState)(null),a=Object(u.a)(i,2),r=a[0],m=a[1],j=Object(c.useState)(null),h=Object(u.a)(j,2),b=h[0],x=h[1],O=Object(c.useState)(800),g=Object(u.a)(O,2),v=g[0],y=g[1],I=Object(c.useState)(null),N=Object(u.a)(I,2),E=N[0],z=N[1],S=Object(c.useContext)(ce),Y=(S.isOnline,S.userId),L=(S.userInfo,window.location.pathname.split("/")[2]);return Object(c.useEffect)((function(){function e(){return(e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.collection("/rooms").doc(L).onSnapshot((function(e){if(e.exists){var t=e.data();console.log(Y,t.members),console.log(-1===t.members.indexOf(Y)),-1===t.members.indexOf(Y)&&(console.log("\u8ffd\u52a0"),p.collection("rooms").doc(L).update({members:f.firestore.FieldValue.arrayUnion(Y)}),p.collection("users").doc(Y).update({rooms:f.firestore.FieldValue.arrayUnion(L)}),p.collection("users").doc(Y).update({room:L}));var n=t.timeStamp.toDate(),o={id:e.id,roomName:t.roomName,stageId:t.stageId,madeTime:n.getFullYear()+"/"+n.getMonth()+"1/"+n.getDate(),madeUserName:t.madeUserName,members:t.members};m(!0),s(o)}else m(!1)}));case 2:return t=e.sent,e.abrupt("return",(function(){return t()}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(c.useEffect)((function(){function e(){return(e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return e.next=3,p.collection("/rooms").doc(L).collection("comments").orderBy("timeStamp","asc").onSnapshot((function(e){var t=e.docs.map((function(e){return e.id})),n=[];e.forEach((function(e){n.push(e.data())}));for(var o=[],c=0;c<t.length;c++)o.push({id:t[c],content:n[c].content,emotion:n[c].emotion,userId:n[c].userId});console.log(t,o,e),x(o)}));case 3:return t=e.sent,e.abrupt("return",(function(){return t()}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t(){return(t=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return e.next=3,p.collection("rooms").doc(L).onSnapshot(function(){var e=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data().members,console.log(n),!n||0===n.length){e.next=5;break}return e.next=5,p.collection("users").where("userId","in",n).get().then((function(e){if(!e.empty){console.log(e);var t={};e.docs.forEach((function(e){var n=e.data(),o=e.data().userId;t[o]={displayName:n.displayName,oneWord:n.oneWord,iconInfo:n.iconinfo}})),console.log(t,e,e.docs),z(t)}}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return t=e.sent,e.abrupt("return",(function(){return t()}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),function(){t.apply(this,arguments)}()}),[r]),Object(o.jsxs)("div",{className:"container",children:[null===r&&Object(o.jsx)("p",{children:"Loading Room..."}),!0===r&&Object(o.jsxs)(X.Provider,{value:{members:E,setMembers:z,room:n,setRoom:s,comments:b,setComments:x,splitSize:v,setSplitSize:y},children:[null===n&&Object(o.jsx)("p",{children:"Loading Room..."}),n&&Object(o.jsxs)("div",{className:"row",children:[Object(o.jsx)(C,{}),Object(o.jsxs)(w.a,{split:"vertical",minSize:300,defaultSize:800,maxSize:1e3,style:{height:window.innerHeight-101},children:[Object(o.jsxs)("div",{id:"left",style:{display:"flex"},children:[null===E&&Object(o.jsx)("p",{children:"Loading Stage..."}),null!==E&&Object(o.jsx)(k,{})]}),Object(o.jsxs)("div",{id:"right",children:[null===b&&Object(o.jsx)("p",{children:"Loading Ccomments..."}),null!==b&&Object(o.jsx)(K,{})]})]})]})]}),0==r&&Object(o.jsx)(B.Redirect,{to:"/error"})]})},K=(n(85),function(){var e=Object(c.useContext)(X),t=e.comments,n=(e.room,e.members);window.location.pathname;return Object(c.useEffect)((function(){var e=function(){for(var e=[],t=0;t<e.length;t++)clearInterval(e[t]);e=[];for(var n=document.getElementsByClassName("comments-iconparts"),o=0;o<n.length;o++)e.push(z(n[o],1e3));return e}();return function(){e.forEach((function(e){clearInterval(e)}))}})),Object(o.jsx)("div",{id:"comments",className:"list-group",children:t&&n&&t.map((function(e){return Object(o.jsxs)("div",{className:"comment list-group-item d-flex",children:[Object(o.jsx)("div",{className:"iconMask commentIcon",children:Object(o.jsx)(b,{iconInfo:n[e.userId].iconInfo,iconSize:50,emotion:e.emotion,where:"comments"})}),Object(o.jsxs)("div",{children:[console.log(n),Object(o.jsx)("strong",{className:"userName mb-1",style:{},children:n[e.userId].displayName}),Object(o.jsx)("h3",{className:"commentContent",style:{},children:e.content})]})]},e.id.toString())}))})}),L=(n(44),{face:{displayName:"\u9854",Kinds:{nomal:{displayKind:"\u30d5\u30c4\u30fc"},monster:{displayKind:"\u5316\u7269"},komugi:{displayKind:"\u5c0f\u9ea6\u8272"},maru:{displayKind:"\u307e\u308b"}}},hair:{displayName:"\u9aea",Kinds:{nomal:{displayKind:"\u30d5\u30c4\u30fc"},cat:{displayKind:"\u30b1\u30e2\u30df\u30df"},tyuni:{displayKind:"\u53a8\u4e8c"},kaku:{displayKind:"\u30ab\u30af\u30ac\u30ea"}}},leftEye:{displayName:"\u5de6\u76ee",Kinds:{nomal:{displayKind:"\u30d5\u30c4\u30fc"},cat:{displayKind:"\u306d\u3053"},red:{displayKind:"\u7d05"},blue:{displayKind:"\u84bc"},tyome:{displayKind:"\u30b3\u30e1"}}},rightEye:{displayName:"\u53f3\u76ee",Kinds:{nomal:{displayKind:"\u30d5\u30c4\u30fc"},cat:{displayKind:"\u306d\u3053"},red:{displayKind:"\u7d05"},blue:{displayKind:"\u84bc"},tyome:{displayKind:"\u30b3\u30e1"}}},nose:{displayName:"\u9f3b",Kinds:{nomal:{displayKind:"\u30d5\u30c4\u30fc"},cat:{displayKind:"\u9006\u4e09\u89d2"},pig:{displayKind:"\u3076\u305f\u3063\u3071\u306a"}}},mouth:{displayName:"\u53e3",Kinds:{nomal:{displayKind:"\u30d5\u30c4\u30fc"},cat:{displayKind:"\u30c0\u30d6\u30ea\u30e5\u30fc"},fang:{displayKind:"\u7259"},tooth:{displayKind:"\u6b6f"}}}});var T={face:{posX:0,posY:0,sizeX:300,sizeY:300,rot:0,kind:"nomal"},hair:{posX:0,posY:0,sizeX:300,sizeY:300,rot:0,kind:"nomal"},leftEye:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"},rightEye:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"},nose:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"},mouth:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"}};var A={face:{max:350,min:200},hair:{max:350,min:200},leftEye:{max:70,min:15},rightEye:{max:70,min:15},mouth:{max:100,min:15},nose:{max:100,min:15}};function F(e){return A[e].max}function M(e){return A[e].min}var R={face:{sizeX:300,sizeY:300},hair:{sizeX:300,sizeY:300},leftEye:{sizeX:30,sizeY:30},rightEye:{sizeX:30,sizeY:30},mouth:{sizeX:40,sizeY:40},nose:{sizeX:40,sizeY:40}};function U(e,t,n){R[e]={sizeX:t,sizeY:n}}var V={face:{max:360,min:0},hair:{max:360,min:0},leftEye:{max:360,min:0},rightEye:{max:360,min:0},mouth:{max:360,min:0},nose:{max:360,min:0}};function D(e){return V[e].max}function P(e){return V[e].min}var W={face:0,hair:0,leftEye:0,rightEye:0,mouth:0,nose:0};function G(e,t){console.log(t),W[e]=t}n(86);var _=function(){var e,t=Object(c.useContext)(J),n=t.setNowKind,s=(t.nowKind,t.nowName);return Object(o.jsxs)("div",{id:"makeIconButtons",className:s+"button",children:[console.log(s),Object.entries((e=s,console.log(e),L[e].Kinds)).map((function(e){return Object(o.jsx)("button",{className:e[0]+" "+s+" iconKindButton btn-text-3d","data-name":s,"data-kind":e[0],onClick:function(e){n(e.target.dataset.kind),document.getElementsByClassName("iconKindButton").forEach((function(e){e.classList.contains("active")&&e.classList.remove("active")})),e.target.classList.add("active")},children:e[1].displayKind},e[0])}))]})},H="./images/icon/",J=Object(c.createContext)([]),Z=function(){var e=Object(c.useState)("nomal"),t=Object(u.a)(e,2),n=t[0],s=t[1],i=Object(c.useState)("leftEye"),a=Object(u.a)(i,2),r=a[0],l=a[1],d=Object(c.useState)(30),m=Object(u.a)(d,2),j=m[0],f=m[1],p=Object(c.useState)(0),h=Object(u.a)(p,2),b=h[0],x=h[1],O=Object(c.useContext)(ce).userInfo;Object(c.useEffect)((function(){var e;O&&(e=O.iconinfo,T=e,Object.entries(O.iconinfo).forEach((function(e){console.log(e[0],e[1].sizeX,e[1].sizeY,e[0],e[1].rot),U(e[0],e[1].sizeX,e[1].sizeY),G(e[0],e[1].rot);var t=document.getElementById(e[0]+"Img");t||((t=document.createElement("img")).classList.add("set-image"),t.classList.add(e[0]),t.id=e[0]+"Img"),v(t,e[1].sizeX,e[1].sizeY,e[1].posX,e[1].posY,e[1].rot,e[1].kind,e[0])})))}),[O]);var g,v=function(e,t,n,o,c,s,i,a){e.src=H+i+"_"+a+".png",e.style.width=t+"px",e.style.height=n+"px",e.style.position="absolute",e.style.left=o+"px",e.style.top=c+"px",e.style.transform="rotate("+s+"deg)";var r={posX:o,posY:c,sizeX:t,sizeY:n,rot:s,kind:i};document.getElementById("icon-space").appendChild(e),function(e,t){T[e]=t}(a,r)};var y,I=function(e){e||(e=r);var t,n=document.getElementById("rotInput"),o=n.value,c=D(e),s=P(e);G(e,t=c<o?c:s>o?s:o),x(t),n.value=t},N=function(e){e||(e=r);var t,n=document.getElementById("sizeInput"),o=n.value,c=F(e),s=M(e);U(e,t=c<o?c:s>o?s:o,t),f(t),n.value=t};Object(c.useContext)(ce).userId;return Object(o.jsxs)("div",{id:"makeIcon",children:[null===O&&Object(o.jsx)("p",{children:"loading infos..."}),null!==O&&Object(o.jsxs)(J.Provider,{value:{nowKind:n,setNowKind:s,nowName:r,setNowName:l,nowSize:j,setNowSize:f,nowRot:b,setNowRot:x},children:[Object(o.jsx)("div",{id:"icon-space",className:"iconMask",onMouseMove:function(e){var t=e.clientX-Math.floor(j/2),n=e.clientY-Math.floor(j/2);document.getElementById("traceImage").style.top=n+"px",document.getElementById("traceImage").style.left=t+"px"},onMouseLeave:function(){document.getElementById("traceImage").style.display="none"},onMouseEnter:function(){document.getElementById("traceImage").style.display="block"},onClick:function(e){N(),I();var t=document.getElementById(r+"Img");t||((t=document.createElement("img")).classList.add("set-image"),t.classList.add(r+"Img"),t.id=r);var o=document.getElementById("icon-space").getBoundingClientRect(),c=window.pageXOffset+o.left,s=window.pageYOffset+o.top,i=e.clientX,a=e.clientY,l=i-c-Math.floor(document.getElementById("sizeInput").value/2),d=a-s-Math.floor(document.getElementById("sizeInput").value/2);v(t,document.getElementById("sizeInput").value,document.getElementById("sizeInput").value,l,d,document.getElementById("rotInput").value,n,r),document.getElementById("save-button").classList.add("active")}}),console.log(H+n+r+"png"),Object(o.jsx)("img",{id:"traceImage",src:H+n+"_"+r+".png",style:{height:j+"px",width:j+"px",zIndex:"100",position:"absolute",display:"none",cursor:"none",pointerEvents:"none",transform:"rotate("+b+"deg)"}}),Object(o.jsxs)("div",{children:["\u56de\u8ee2",Object(o.jsx)("input",{type:"number",id:"rotInput",onInput:function(e){y&&clearTimeout(y),y=setTimeout(I,1e3)},min:P(r),max:D(r),defaultValue:"0"}),"\u30b5\u30a4\u30ba",Object(o.jsx)("input",{type:"number",id:"sizeInput",onInput:function(e){g&&clearTimeout(g),g=setTimeout(N,1e3)},min:M(r),max:F(r),defaultValue:"30"})]}),Object(o.jsx)("div",{id:"name-buttons",className:"",children:Object.entries(L).map((function(e){return Object(o.jsx)("button",{className:e[0]+" iconNameButton btn-border_buttom","data-name":e[0],onClick:function(e){var t,n;document.getElementsByClassName("iconNameButton").forEach((function(e){e.classList.contains("active")&&e.classList.remove("active")})),e.target.classList.add("active"),l(e.target.dataset.name),s((t=e.target.dataset.name,n="kind",T[t][n])),document.getElementById("sizeInput").value=function(e){return console.log(e,R[e].sizeX),R[e].sizeX}(e.target.dataset.name),document.getElementById("rotInput").value=function(e){return W[e]}(e.target.dataset.name),N(e.target.dataset.name),I(e.target.dataset.name)},children:e[1].displayName},e[0])}))}),Object(o.jsx)(_,{})]})]})},Q=function(){var e=Object(c.useContext)(ce),t=e.setUserId,n=(e.setUserName,e.setIsOnline),s=e.isOnline,i=function(){f.auth().signOut(),n(!1),t(null)};return Object(o.jsxs)("div",{children:[!0===s&&Object(o.jsxs)("div",{children:["\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f\uff01",Object(o.jsx)(m.Redirect,{to:"/userSetting"})]}),!1===s&&Object(o.jsxs)("div",{children:["\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u307e\u305b\u3093",Object(o.jsx)("button",{onClick:function(){se=!0,f.auth().setPersistence(f.auth.Auth.Persistence.LOCAL).then(function(){var e=new f.auth.GoogleAuthProvider;f.auth().signInWithPopup(e).then(function(){var e=Object(d.a)(l.a.mark((function e(o){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.collection("/users").where("userId","==",o.user.uid).get().then((function(e){console.log(e),e.empty?(console.log("No user"),p.collection("users").doc(o.user.uid).set({userId:o.user.uid,displayName:"\u30b2\u30b9\u30c8",oneWord:"",room:null,rooms:[],iconinfo:{face:{posX:0,posY:0,sizeX:300,sizeY:300,rot:0,kind:"nomal"},hair:{posX:0,posY:0,sizeX:300,sizeY:300,rot:0,kind:"nomal"},leftEye:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"},rightEye:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"},nose:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"},mouth:{posX:0,posY:0,sizeX:50,sizeY:50,rot:0,kind:"nomal"}}}).then(function(){var e=Object(d.a)(l.a.mark((function e(c){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.collection("users").doc(o.user.uid).collection("seclet").doc(o.user.uid).set({userName:o.user.displayName,email:o.user.email}).then((function(){console.log("login fin"),n(!0),t(o.user.uid)})).catch((function(e){p.collection("users").doc(o.user.uid).delete().then((function(){i(),alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3001\u3082\u3046\u4e00\u5ea6\u30ed\u30b0\u30a4\u30f3\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002Error:"+e),console.log(e)}))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){i(),alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3001\u3082\u3046\u4e00\u5ea6\u30ed\u30b0\u30a4\u30f3\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002Error:"+e),console.log(e)}))):(n(!0),t(o.user.uid))})).catch((function(e){console.log("Error : ",e)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}().bind(this)).catch((function(e){return alert("Google\u3067\u30b5\u30a4\u30f3\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002 Error: ",e),console.log(e),!1}))}.bind(undefined))},children:"Google\u3067\u30ed\u30b0\u30a4\u30f3"})]}),null===s&&Object(o.jsx)(o.Fragment,{children:"loading aouth..."})]})},q=(n(89),function(){var e=Object(c.useContext)(ce),t=e.setIsOnline,n=(e.isOnline,e.setUserId),s=e.userId,i=e.userInfo,a=function(){f.auth().signOut(),t(!1),n(null)};return Object(o.jsxs)("div",{children:[null===i&&Object(o.jsx)("p",{children:"Loading userInfo..."}),i&&Object(o.jsxs)("div",{children:[Object(o.jsxs)("ul",{children:[Object(o.jsxs)("li",{children:[Object(o.jsx)("h4",{children:"\u8868\u793a\u540d"}),Object(o.jsx)("input",{id:"displayName-input",type:"text",maxLength:"15",defaultValue:i.displayName,onChange:function(){document.getElementById("save-button").classList.add("active")}})]}),Object(o.jsxs)("li",{children:[Object(o.jsx)("h4",{children:"\u3072\u3068\u3053\u3068"}),Object(o.jsx)("h3",{children:Object(o.jsx)("input",{id:"oneWord-input",type:"text",maxLength:"30",defaultValue:i.oneWord,onChange:function(){document.getElementById("save-button").classList.add("active")}})})]}),Object(o.jsxs)("li",{children:[Object(o.jsx)("h4",{children:"\u540d\u524d"}),Object(o.jsx)("h3",{children:i.userName})]}),Object(o.jsxs)("li",{children:[Object(o.jsx)("h4",{children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),Object(o.jsx)("h3",{children:i.email})]}),Object(o.jsxs)("li",{children:[Object(o.jsx)("h4",{children:"Google\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u307e\u3059"}),Object(o.jsx)("button",{onClick:a,children:"\u30ed\u30b0\u30a2\u30a6\u30c8"})]})]}),Object(o.jsx)("a",{id:"save-button",onClick:function(){if(document.getElementById("save-button").classList.contains("active")){var e=document.getElementById("displayName-input").value,t=document.getElementById("oneWord-input").value;p.collection("users").doc(s).update({displayName:e,oneWord:t}).then((function(e){var t=T;p.collection("users").doc(s).update({iconinfo:t}).then((function(){document.location.reload()})).catch((function(e){console.log(e)}))})).catch((function(e){a(),alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u3082\u3046\u4e00\u5ea6\u30ed\u30b0\u30a4\u30f3\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002Error:"+e),console.log(e)}))}},children:"\u5909\u66f4\u3092\u4fdd\u5b58"})]})]})}),$=(n(90),function(){var e=Object(c.useContext)(ce),t=e.isOnline;e.setIsOnline,e.userId,e.setUserId,e.userInfo,e.setUserInfo;return Object(o.jsxs)("div",{children:[null===t&&Object(o.jsx)("p",{children:"loading...."}),!0===t&&Object(o.jsxs)("div",{id:"settings",children:[Object(o.jsx)(Z,{}),Object(o.jsx)(q,{})]}),!1===t&&Object(o.jsx)(Q,{})]})}),ee=function(){var e=Object(c.useContext)(ce),t=e.userId,n=e.userInfo;return Object(o.jsxs)("div",{id:"roomForm",children:[Object(o.jsx)("label",{htmlFor:"name",children:"\u30eb\u30fc\u30e0\u306e\u540d\u524d"}),Object(o.jsx)("input",{id:"nameInput",type:"text",name:"name",maxLength:"15"}),Object(o.jsx)("br",{}),Object(o.jsx)("label",{htmlFor:"stage",defaultValue:"0",children:"\u30b9\u30c6\u30fc\u30b8"}),Object(o.jsxs)("select",{id:"stage",name:"stage",className:"custom-select",children:[Object(o.jsx)("option",{value:"0",children:"Zero"}),Object(o.jsx)("option",{value:"1",children:"One"}),Object(o.jsx)("option",{value:"2",children:"Two"})]}),Object(o.jsx)("br",{}),Object(o.jsx)("button",{onClick:function(){var e=document.getElementById("nameInput").value;if(e.length>0&&e.length<=15){var o=document.getElementById("stage").value;console.log(e,o),p.collection("/rooms").add({roomName:e,stageId:o,madeUserId:t,madeUserName:n.displayName,timeStamp:f.firestore.FieldValue.serverTimestamp(),members:[]}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}else alert("\u30eb\u30fc\u30e0\u540d\u306f1\u6587\u5b57\u4ee5\u4e0a\u300115\u6587\u5b57\u4ee5\u4e0b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002")},children:"\u6295\u7a3f"})]})},te=function(){var e=Object(c.useState)(null),t=Object(u.a)(e,2),n=t[0],s=t[1];return Object(c.useEffect)((function(){function e(){return(e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.collection("/rooms").orderBy("timeStamp","asc").get().then((function(e){console.log("\u307a");var t=e.docs.map((function(e){return e.id})),n=[];e.forEach((function(e){n.push(e.data())})),e.docChanges().forEach((function(e){console.log(e.doc.data())})),console.log(t,n);for(var o=[],c=0;c<t.length;c++){console.log(n);var i=n[c].timeStamp.toDate();console.log(i,i.getFullYear()+"/"+i.getMonth()+"1/"+i.getDate(),n[c].timeStamp,n[c]),o.push({roomName:n[c].roomName,stageId:n[c].stageId,madeTime:i.getFullYear()+"/"+i.getMonth()+"1/"+i.getDate(),madeUserName:n[c].madeUserName,members:n[c].members,id:t[c]})}s(o)}));case 2:e.sent;case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(o.jsxs)("div",{id:"rooms",className:"list-group",children:[null===n&&Object(o.jsx)("p",{children:"Loading rooms..."}),n&&n.map((function(e){return Object(o.jsxs)("li",{className:"roomsItem list-group-item d-flex",children:[Object(o.jsx)(a.b,{to:"/room/".concat(e.id),children:Object(o.jsx)("h4",{children:e.roomName})}),Object(o.jsxs)("h4",{children:["\u4f5c\u6210\u8005\uff1a",e.madeUserName]}),console.log(e.madeTime),Object(o.jsxs)("h4",{children:["\u4f5c\u6210\u65e5\u6642\uff1a",e.madeTime]}),Object(o.jsxs)("h4",{children:["\u30e1\u30f3\u30d0\u30fc\uff1a",e.members.length,"\u4eba"]})]},e.id)}))]})},ne=function(){return Object(o.jsxs)("div",{id:"roomsAndForm",children:[Object(o.jsx)(te,{}),Object(o.jsx)(ee,{})]})},oe=function(){return Object(o.jsx)("div",{children:Object(o.jsx)("p",{children:"\u30da\u30fc\u30b8\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u524a\u9664\u30fb\u5909\u66f4\u3055\u308c\u305f\u304b\u3001URL\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002"})})},ce=Object(c.createContext)(),se=!1;var ie=function(){var e=Object(c.useState)(null),t=Object(u.a)(e,2),n=t[0],s=t[1],i=Object(c.useState)(null),a=Object(u.a)(i,2),r=a[0],j=a[1],h=Object(c.useState)(null),b=Object(u.a)(h,2),O=b[0],g=b[1];return Object(c.useEffect)((function(){function e(){return(e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=5;break}return e.next=3,p.collection("users").doc(r).onSnapshot((function(e){p.collection("users").doc(r).collection("seclet").doc(r).get().then((function(t){var n=e.data(),o=t.data();console.log(n,o),console.log("\u3093\u30fc"),g({userName:o.userName,email:o.email,displayName:n.displayName,oneWord:n.oneWord,iconinfo:n.iconinfo,rooms:n.rooms,room:n.room})}))}));case 3:return t=e.sent,e.abrupt("return",(function(){return t()}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[r]),Object(c.useEffect)((function(){f.auth().onAuthStateChanged(function(){var e=Object(d.a)(l.a.mark((function e(t){var n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,o=null,t&&(o=t.uid,n=!0),!1===se&&(j(o),s(n),console.log("\u308f\u3041\u3063\u3068",se));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}().bind(undefined))})),Object(o.jsx)("div",{children:Object(o.jsxs)(ce.Provider,{value:{isOnline:n,setIsOnline:s,userId:r,setUserId:j,userInfo:O,setUserInfo:g},children:[Object(o.jsx)(x,{}),Object(o.jsxs)(m.Switch,{children:[Object(o.jsx)(m.Route,{exact:!0,path:"/login",component:Q}),console.log(r),!1===n&&Object(o.jsx)(m.Redirect,{to:"/login"}),!0===n&&Object(o.jsxs)(m.Switch,{children:[Object(o.jsx)(m.Route,{exact:!0,path:"/error",component:oe}),Object(o.jsx)(m.Route,{exact:!0,path:"/",component:ne}),Object(o.jsx)(m.Route,{exact:!0,path:"/userSetting",component:$}),Object(o.jsx)(m.Route,{exact:!0,path:"/room/:id",component:Y}),Object(o.jsx)(m.Redirect,{to:"/error"})]}),Object(o.jsx)(o.Fragment,{children:"loading..."})]})]})})};n(91);i.a.render(Object(o.jsx)(a.a,{children:Object(o.jsx)(ie,{})}),document.getElementById("root"))}},[[92,1,2]]]);
//# sourceMappingURL=main.3dcf0f68.chunk.js.map